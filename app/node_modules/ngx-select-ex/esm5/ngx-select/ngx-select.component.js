import { __decorate, __param, __read, __spread } from "tslib";
import { AfterContentChecked, DoCheck, Input, Output, ViewChild, Component, ElementRef, EventEmitter, forwardRef, HostListener, IterableDiffer, IterableDiffers, ChangeDetectorRef, ContentChild, TemplateRef, Optional, Inject, InjectionToken, ChangeDetectionStrategy, OnDestroy } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { DomSanitizer, SafeHtml } from '@angular/platform-browser';
import { Subject, BehaviorSubject, EMPTY, of, from, merge, combineLatest } from 'rxjs';
import { tap, filter, map, share, flatMap, toArray, distinctUntilChanged } from 'rxjs/operators';
import * as lodashNs from 'lodash';
import * as escapeStringNs from 'escape-string-regexp';
import { NgxSelectOptGroup, NgxSelectOption } from './ngx-select.classes';
import { NgxSelectOptionDirective, NgxSelectOptionNotFoundDirective, NgxSelectOptionSelectedDirective } from './ngx-templates.directive';
var _ = lodashNs;
var escapeString = escapeStringNs;
export var NGX_SELECT_OPTIONS = new InjectionToken('NGX_SELECT_OPTIONS');
var ENavigation;
(function (ENavigation) {
    ENavigation[ENavigation["first"] = 0] = "first";
    ENavigation[ENavigation["previous"] = 1] = "previous";
    ENavigation[ENavigation["next"] = 2] = "next";
    ENavigation[ENavigation["last"] = 3] = "last";
    ENavigation[ENavigation["firstSelected"] = 4] = "firstSelected";
    ENavigation[ENavigation["firstIfOptionActiveInvisible"] = 5] = "firstIfOptionActiveInvisible";
})(ENavigation || (ENavigation = {}));
function propertyExists(obj, propertyName) {
    return propertyName in obj;
}
var NgxSelectComponent = /** @class */ (function () {
    function NgxSelectComponent(iterableDiffers, sanitizer, cd, defaultOptions) {
        var _this = this;
        this.sanitizer = sanitizer;
        this.cd = cd;
        this.optionValueField = 'id';
        this.optionTextField = 'text';
        this.optGroupLabelField = 'label';
        this.optGroupOptionsField = 'options';
        this.multiple = false;
        this.allowClear = false;
        this.placeholder = '';
        this.noAutoComplete = false;
        this.disabled = false;
        this.defaultValue = [];
        this.autoSelectSingleOption = false;
        this.autoClearSearch = false;
        this.noResultsFound = 'No results found';
        this.size = 'default';
        this.autoActiveOnMouseEnter = true;
        this.showOptionNotFoundForEmptyItems = false;
        this.isFocused = false;
        this.keepSelectMenuOpened = false;
        this.autocomplete = 'off';
        this.dropDownMenuOtherClasses = '';
        this.keyCodeToRemoveSelected = 'Delete';
        this.keyCodeToOptionsOpen = ['Enter', 'NumpadEnter'];
        this.keyCodeToOptionsClose = 'Escape';
        this.keyCodeToOptionsSelect = ['Enter', 'NumpadEnter'];
        this.keyCodeToNavigateFirst = 'ArrowLeft';
        this.keyCodeToNavigatePrevious = 'ArrowUp';
        this.keyCodeToNavigateNext = 'ArrowDown';
        this.keyCodeToNavigateLast = 'ArrowRight';
        this.typed = new EventEmitter();
        this.focus = new EventEmitter();
        this.blur = new EventEmitter();
        this.open = new EventEmitter();
        this.close = new EventEmitter();
        this.select = new EventEmitter();
        this.remove = new EventEmitter();
        this.navigated = new EventEmitter();
        this.selectionChanges = new EventEmitter();
        this.optionsOpened = false;
        this.actualValue = [];
        this.subjOptions = new BehaviorSubject([]);
        this.subjSearchText = new BehaviorSubject('');
        this.subjOptionsSelected = new BehaviorSubject([]);
        this.subjExternalValue = new BehaviorSubject([]);
        this.subjDefaultValue = new BehaviorSubject([]);
        this.subjRegisterOnChange = new Subject();
        this._focusToInput = false;
        //////////// interface ControlValueAccessor ////////////
        this.onChange = function (v) { return v; };
        this.onTouched = function () { return null; };
        Object.assign(this, defaultOptions);
        // DIFFERS
        this.itemsDiffer = iterableDiffers.find([]).create(null);
        this.defaultValueDiffer = iterableDiffers.find([]).create(null);
        // OBSERVERS
        this.typed.subscribe(function (text) { return _this.subjSearchText.next(text); });
        this.subjOptionsSelected.subscribe(function (options) { return _this.selectionChanges.emit(options); });
        var cacheExternalValue;
        // Get actual value
        var subjActualValue = combineLatest([
            merge(this.subjExternalValue.pipe(map(function (v) { return cacheExternalValue = v === null ? [] : [].concat(v); })), this.subjOptionsSelected.pipe(map(function (options) { return options.map(function (o) { return o.value; }); }))),
            this.subjDefaultValue
        ]).pipe(map(function (_a) {
            var _b = __read(_a, 2), eVal = _b[0], dVal = _b[1];
            var newVal = _.isEqual(eVal, dVal) ? [] : eVal;
            return newVal.length ? newVal : dVal;
        }), distinctUntilChanged(function (x, y) { return _.isEqual(x, y); }), share());
        // Export actual value
        combineLatest([subjActualValue, this.subjRegisterOnChange])
            .pipe(map(function (_a) {
            var _b = __read(_a, 1), actualValue = _b[0];
            return actualValue;
        }))
            .subscribe(function (actualValue) {
            _this.actualValue = actualValue;
            if (!_.isEqual(actualValue, cacheExternalValue)) {
                cacheExternalValue = actualValue;
                if (_this.multiple) {
                    _this.onChange(actualValue);
                }
                else {
                    _this.onChange(actualValue.length ? actualValue[0] : null);
                }
            }
        });
        // Correct selected options when the options changed
        combineLatest([
            this.subjOptions.pipe(flatMap(function (options) { return from(options).pipe(flatMap(function (option) { return option instanceof NgxSelectOption
                ? of(option)
                : (option instanceof NgxSelectOptGroup ? from(option.options) : EMPTY); }), toArray()); })),
            subjActualValue
        ]).pipe(map(function (_a) {
            var _b = __read(_a, 2), optionsFlat = _b[0], actualValue = _b[1];
            var optionsSelected = [];
            actualValue.forEach(function (value) {
                var selectedOption = optionsFlat.find(function (option) { return option.value === value; });
                if (selectedOption) {
                    optionsSelected.push(selectedOption);
                }
            });
            if (_this.keepSelectedItems) {
                var optionValues_1 = optionsSelected.map(function (option) { return option.value; });
                var keptSelectedOptions = _this.subjOptionsSelected.value
                    .filter(function (selOption) { return optionValues_1.indexOf(selOption.value) === -1; });
                optionsSelected.push.apply(optionsSelected, __spread(keptSelectedOptions));
            }
            if (!_.isEqual(optionsSelected, _this.subjOptionsSelected.value)) {
                _this.subjOptionsSelected.next(optionsSelected);
                _this.cd.markForCheck();
            }
        })).subscribe();
        // Ensure working filter by a search text
        combineLatest([this.subjOptions, this.subjOptionsSelected, this.subjSearchText]).pipe(map(function (_a) {
            var _b = __read(_a, 3), options = _b[0], selectedOptions = _b[1], search = _b[2];
            _this.optionsFiltered = _this.filterOptions(search, options, selectedOptions).map(function (option) {
                if (option instanceof NgxSelectOption) {
                    option.highlightedText = _this.highlightOption(option);
                }
                else if (option instanceof NgxSelectOptGroup) {
                    option.options.map(function (subOption) {
                        subOption.highlightedText = _this.highlightOption(subOption);
                        return subOption;
                    });
                }
                return option;
            });
            _this.cacheOptionsFilteredFlat = null;
            _this.navigateOption(ENavigation.firstIfOptionActiveInvisible);
            _this.cd.markForCheck();
            return selectedOptions;
        }), flatMap(function (selectedOptions) { return _this.optionsFilteredFlat().pipe(filter(function (flatOptions) { return _this.autoSelectSingleOption && flatOptions.length === 1 && !selectedOptions.length; })); })).subscribe(function (flatOptions) {
            _this.subjOptionsSelected.next(flatOptions);
            _this.cd.markForCheck();
        });
    }
    NgxSelectComponent_1 = NgxSelectComponent;
    Object.defineProperty(NgxSelectComponent.prototype, "inputText", {
        /** @internal */
        get: function () {
            if (this.inputElRef && this.inputElRef.nativeElement) {
                return this.inputElRef.nativeElement.value;
            }
            return '';
        },
        enumerable: true,
        configurable: true
    });
    NgxSelectComponent.prototype.setFormControlSize = function (otherClassNames, useFormControl) {
        if (otherClassNames === void 0) { otherClassNames = {}; }
        if (useFormControl === void 0) { useFormControl = true; }
        var formControlExtraClasses = useFormControl ? {
            'form-control-sm input-sm': this.size === 'small',
            'form-control-lg input-lg': this.size === 'large'
        } : {};
        return Object.assign(formControlExtraClasses, otherClassNames);
    };
    NgxSelectComponent.prototype.setBtnSize = function () {
        return { 'btn-sm': this.size === 'small', 'btn-lg': this.size === 'large' };
    };
    Object.defineProperty(NgxSelectComponent.prototype, "optionsSelected", {
        get: function () {
            return this.subjOptionsSelected.value;
        },
        enumerable: true,
        configurable: true
    });
    NgxSelectComponent.prototype.mainClicked = function (event) {
        event.clickedSelectComponent = this;
        if (!this.isFocused) {
            this.isFocused = true;
            this.focus.emit();
        }
    };
    NgxSelectComponent.prototype.documentClick = function (event) {
        if (event.clickedSelectComponent !== this) {
            if (this.optionsOpened) {
                this.optionsClose();
                this.cd.detectChanges(); // fix error because of delay between different events
            }
            if (this.isFocused) {
                this.isFocused = false;
                this.blur.emit();
            }
        }
    };
    NgxSelectComponent.prototype.optionsFilteredFlat = function () {
        var _this = this;
        if (this.cacheOptionsFilteredFlat) {
            return of(this.cacheOptionsFilteredFlat);
        }
        return from(this.optionsFiltered).pipe(flatMap(function (option) {
            return option instanceof NgxSelectOption ? of(option) :
                (option instanceof NgxSelectOptGroup ? from(option.optionsFiltered) : EMPTY);
        }), filter(function (optionsFilteredFlat) { return !optionsFilteredFlat.disabled; }), toArray(), tap(function (optionsFilteredFlat) { return _this.cacheOptionsFilteredFlat = optionsFilteredFlat; }));
    };
    NgxSelectComponent.prototype.navigateOption = function (navigation) {
        var _this = this;
        this.optionsFilteredFlat().pipe(map(function (options) {
            var navigated = { index: -1, activeOption: null, filteredOptionList: options };
            var newActiveIdx;
            switch (navigation) {
                case ENavigation.first:
                    navigated.index = 0;
                    break;
                case ENavigation.previous:
                    newActiveIdx = options.indexOf(_this.optionActive) - 1;
                    navigated.index = newActiveIdx >= 0 ? newActiveIdx : options.length - 1;
                    break;
                case ENavigation.next:
                    newActiveIdx = options.indexOf(_this.optionActive) + 1;
                    navigated.index = newActiveIdx < options.length ? newActiveIdx : 0;
                    break;
                case ENavigation.last:
                    navigated.index = options.length - 1;
                    break;
                case ENavigation.firstSelected:
                    if (_this.subjOptionsSelected.value.length) {
                        navigated.index = options.indexOf(_this.subjOptionsSelected.value[0]);
                    }
                    break;
                case ENavigation.firstIfOptionActiveInvisible:
                    var idxOfOptionActive = -1;
                    if (_this.optionActive) {
                        idxOfOptionActive = options.indexOf(options.find(function (x) { return x.value === _this.optionActive.value; }));
                    }
                    navigated.index = idxOfOptionActive > 0 ? idxOfOptionActive : 0;
                    break;
            }
            navigated.activeOption = options[navigated.index];
            return navigated;
        })).subscribe(function (newNavigated) { return _this.optionActivate(newNavigated); });
    };
    NgxSelectComponent.prototype.ngDoCheck = function () {
        if (this.itemsDiffer.diff(this.items)) {
            this.subjOptions.next(this.buildOptions(this.items));
        }
        var defVal = this.defaultValue ? [].concat(this.defaultValue) : [];
        if (this.defaultValueDiffer.diff(defVal)) {
            this.subjDefaultValue.next(defVal);
        }
    };
    NgxSelectComponent.prototype.ngAfterContentChecked = function () {
        if (this._focusToInput && this.checkInputVisibility() && this.inputElRef &&
            this.inputElRef.nativeElement !== document.activeElement) {
            this._focusToInput = false;
            this.inputElRef.nativeElement.focus();
        }
        if (this.choiceMenuElRef) {
            var ulElement = this.choiceMenuElRef.nativeElement;
            var element = ulElement.querySelector('a.ngx-select__item_active.active');
            if (element && element.offsetHeight > 0) {
                this.ensureVisibleElement(element);
            }
        }
    };
    NgxSelectComponent.prototype.ngOnDestroy = function () {
        this.cd.detach();
    };
    NgxSelectComponent.prototype.canClearNotMultiple = function () {
        return this.allowClear && !!this.subjOptionsSelected.value.length &&
            (!this.subjDefaultValue.value.length || this.subjDefaultValue.value[0] !== this.actualValue[0]);
    };
    NgxSelectComponent.prototype.focusToInput = function () {
        this._focusToInput = true;
    };
    NgxSelectComponent.prototype.inputKeyDown = function (event) {
        var keysForOpenedState = [].concat(this.keyCodeToOptionsSelect, this.keyCodeToNavigateFirst, this.keyCodeToNavigatePrevious, this.keyCodeToNavigateNext, this.keyCodeToNavigateLast);
        var keysForClosedState = [].concat(this.keyCodeToOptionsOpen, this.keyCodeToRemoveSelected);
        if (this.optionsOpened && keysForOpenedState.indexOf(event.code) !== -1) {
            event.preventDefault();
            event.stopPropagation();
            switch (event.code) {
                case ([].concat(this.keyCodeToOptionsSelect).indexOf(event.code) + 1) && event.code:
                    this.optionSelect(this.optionActive);
                    this.navigateOption(ENavigation.next);
                    break;
                case this.keyCodeToNavigateFirst:
                    this.navigateOption(ENavigation.first);
                    break;
                case this.keyCodeToNavigatePrevious:
                    this.navigateOption(ENavigation.previous);
                    break;
                case this.keyCodeToNavigateLast:
                    this.navigateOption(ENavigation.last);
                    break;
                case this.keyCodeToNavigateNext:
                    this.navigateOption(ENavigation.next);
                    break;
            }
        }
        else if (!this.optionsOpened && keysForClosedState.indexOf(event.code) !== -1) {
            event.preventDefault();
            event.stopPropagation();
            switch (event.code) {
                case ([].concat(this.keyCodeToOptionsOpen).indexOf(event.code) + 1) && event.code:
                    this.optionsOpen();
                    break;
                case this.keyCodeToRemoveSelected:
                    this.optionRemove(this.subjOptionsSelected.value[this.subjOptionsSelected.value.length - 1], event);
                    break;
            }
        }
    };
    NgxSelectComponent.prototype.trackByOption = function (index, option) {
        return option instanceof NgxSelectOption ? option.value :
            (option instanceof NgxSelectOptGroup ? option.label : option);
    };
    NgxSelectComponent.prototype.checkInputVisibility = function () {
        return (this.multiple === true) || (this.optionsOpened && !this.noAutoComplete);
    };
    /** @internal */
    NgxSelectComponent.prototype.inputKeyUp = function (value, event) {
        if (value === void 0) { value = ''; }
        if (event.code === this.keyCodeToOptionsClose) {
            this.optionsClose( /*true*/);
        }
        else if (this.optionsOpened && (['ArrowDown', 'ArrowUp', 'ArrowLeft', 'ArrowDown'].indexOf(event.code) === -1) /*ignore arrows*/) {
            this.typed.emit(value);
        }
        else if (!this.optionsOpened && value) {
            this.optionsOpen(value);
        }
    };
    /** @internal */
    NgxSelectComponent.prototype.inputClick = function (value) {
        if (value === void 0) { value = ''; }
        if (!this.optionsOpened) {
            this.optionsOpen(value);
        }
    };
    /** @internal */
    NgxSelectComponent.prototype.sanitize = function (html) {
        return html ? this.sanitizer.bypassSecurityTrustHtml(html) : null;
    };
    /** @internal */
    NgxSelectComponent.prototype.highlightOption = function (option) {
        if (this.inputElRef) {
            return option.renderText(this.sanitizer, this.inputElRef.nativeElement.value);
        }
        return option.renderText(this.sanitizer, '');
    };
    /** @internal */
    NgxSelectComponent.prototype.optionSelect = function (option, event) {
        if (event === void 0) { event = null; }
        if (event) {
            event.preventDefault();
            event.stopPropagation();
        }
        if (option && !option.disabled) {
            this.subjOptionsSelected.next((this.multiple ? this.subjOptionsSelected.value : []).concat([option]));
            this.select.emit(option.value);
            if (!this.keepSelectMenuOpened) {
                this.optionsClose( /*true*/);
            }
            this.onTouched();
        }
    };
    /** @internal */
    NgxSelectComponent.prototype.optionRemove = function (option, event) {
        if (!this.disabled && option) {
            event.stopPropagation();
            this.subjOptionsSelected.next((this.multiple ? this.subjOptionsSelected.value : []).filter(function (o) { return o !== option; }));
            this.remove.emit(option.value);
        }
    };
    /** @internal */
    NgxSelectComponent.prototype.optionActivate = function (navigated) {
        if ((this.optionActive !== navigated.activeOption) &&
            (!navigated.activeOption || !navigated.activeOption.disabled)) {
            if (this.optionActive) {
                this.optionActive.active = false;
            }
            this.optionActive = navigated.activeOption;
            if (this.optionActive) {
                this.optionActive.active = true;
            }
            this.navigated.emit(navigated);
            this.cd.detectChanges();
        }
    };
    /** @internal */
    NgxSelectComponent.prototype.onMouseEnter = function (navigated) {
        if (this.autoActiveOnMouseEnter) {
            this.optionActivate(navigated);
        }
    };
    NgxSelectComponent.prototype.filterOptions = function (search, options, selectedOptions) {
        var _this = this;
        var regExp = new RegExp(escapeString(search), 'i'), filterOption = function (option) {
            if (_this.searchCallback) {
                return _this.searchCallback(search, option);
            }
            return (!search || regExp.test(option.text)) && (!_this.multiple || selectedOptions.indexOf(option) === -1);
        };
        return options.filter(function (option) {
            if (option instanceof NgxSelectOption) {
                return filterOption(option);
            }
            else if (option instanceof NgxSelectOptGroup) {
                var subOp = option;
                subOp.filter(function (subOption) { return filterOption(subOption); });
                return subOp.optionsFiltered.length;
            }
        });
    };
    NgxSelectComponent.prototype.ensureVisibleElement = function (element) {
        if (this.choiceMenuElRef && this.cacheElementOffsetTop !== element.offsetTop) {
            this.cacheElementOffsetTop = element.offsetTop;
            var container = this.choiceMenuElRef.nativeElement;
            if (this.cacheElementOffsetTop < container.scrollTop) {
                container.scrollTop = this.cacheElementOffsetTop;
            }
            else if (this.cacheElementOffsetTop + element.offsetHeight > container.scrollTop + container.clientHeight) {
                container.scrollTop = this.cacheElementOffsetTop + element.offsetHeight - container.clientHeight;
            }
        }
    };
    NgxSelectComponent.prototype.showChoiceMenu = function () {
        return this.optionsOpened && (!!this.subjOptions.value.length || this.showOptionNotFoundForEmptyItems);
    };
    NgxSelectComponent.prototype.optionsOpen = function (search) {
        if (search === void 0) { search = ''; }
        if (!this.disabled) {
            this.optionsOpened = true;
            this.subjSearchText.next(search);
            if (!this.multiple && this.subjOptionsSelected.value.length) {
                this.navigateOption(ENavigation.firstSelected);
            }
            else {
                this.navigateOption(ENavigation.first);
            }
            this.focusToInput();
            this.open.emit();
            this.cd.markForCheck();
        }
    };
    NgxSelectComponent.prototype.optionsClose = function ( /*focusToHost: boolean = false*/) {
        this.optionsOpened = false;
        // if (focusToHost) {
        //     const x = window.scrollX, y = window.scrollY;
        //     this.mainElRef.nativeElement.focus();
        //     window.scrollTo(x, y);
        // }
        this.close.emit();
        if (this.autoClearSearch && this.multiple && this.inputElRef) {
            this.inputElRef.nativeElement.value = null;
        }
    };
    NgxSelectComponent.prototype.buildOptions = function (data) {
        var _this = this;
        var result = [];
        if (Array.isArray(data)) {
            data.forEach(function (item) {
                var isOptGroup = typeof item === 'object' && item !== null &&
                    propertyExists(item, _this.optGroupLabelField) && propertyExists(item, _this.optGroupOptionsField) &&
                    Array.isArray(item[_this.optGroupOptionsField]);
                if (isOptGroup) {
                    var optGroup_1 = new NgxSelectOptGroup(item[_this.optGroupLabelField]);
                    item[_this.optGroupOptionsField].forEach(function (subOption) {
                        var opt = _this.buildOption(subOption, optGroup_1);
                        if (opt) {
                            optGroup_1.options.push(opt);
                        }
                    });
                    result.push(optGroup_1);
                }
                else {
                    var option = _this.buildOption(item, null);
                    if (option) {
                        result.push(option);
                    }
                }
            });
        }
        return result;
    };
    NgxSelectComponent.prototype.buildOption = function (data, parent) {
        var value, text, disabled;
        if (typeof data === 'string' || typeof data === 'number') {
            value = text = data;
            disabled = false;
        }
        else if (typeof data === 'object' && data !== null &&
            (propertyExists(data, this.optionValueField) || propertyExists(data, this.optionTextField))) {
            value = propertyExists(data, this.optionValueField) ? data[this.optionValueField] : data[this.optionTextField];
            text = propertyExists(data, this.optionTextField) ? data[this.optionTextField] : data[this.optionValueField];
            disabled = propertyExists(data, 'disabled') ? data['disabled'] : false;
        }
        else {
            return null;
        }
        return new NgxSelectOption(value, text, disabled, data, parent);
    };
    NgxSelectComponent.prototype.writeValue = function (obj) {
        this.subjExternalValue.next(obj);
    };
    NgxSelectComponent.prototype.registerOnChange = function (fn) {
        this.onChange = fn;
        this.subjRegisterOnChange.next();
    };
    NgxSelectComponent.prototype.registerOnTouched = function (fn) {
        this.onTouched = fn;
    };
    NgxSelectComponent.prototype.setDisabledState = function (isDisabled) {
        this.disabled = isDisabled;
        this.cd.markForCheck();
    };
    var NgxSelectComponent_1;
    NgxSelectComponent.ctorParameters = function () { return [
        { type: IterableDiffers },
        { type: DomSanitizer },
        { type: ChangeDetectorRef },
        { type: undefined, decorators: [{ type: Inject, args: [NGX_SELECT_OPTIONS,] }, { type: Optional }] }
    ]; };
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "items", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "optionValueField", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "optionTextField", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "optGroupLabelField", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "optGroupOptionsField", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "multiple", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "allowClear", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "placeholder", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "noAutoComplete", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "disabled", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "defaultValue", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "autoSelectSingleOption", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "autoClearSearch", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "noResultsFound", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "keepSelectedItems", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "size", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "searchCallback", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "autoActiveOnMouseEnter", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "showOptionNotFoundForEmptyItems", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "isFocused", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "keepSelectMenuOpened", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "autocomplete", void 0);
    __decorate([
        Input()
    ], NgxSelectComponent.prototype, "dropDownMenuOtherClasses", void 0);
    __decorate([
        Output()
    ], NgxSelectComponent.prototype, "typed", void 0);
    __decorate([
        Output()
    ], NgxSelectComponent.prototype, "focus", void 0);
    __decorate([
        Output()
    ], NgxSelectComponent.prototype, "blur", void 0);
    __decorate([
        Output()
    ], NgxSelectComponent.prototype, "open", void 0);
    __decorate([
        Output()
    ], NgxSelectComponent.prototype, "close", void 0);
    __decorate([
        Output()
    ], NgxSelectComponent.prototype, "select", void 0);
    __decorate([
        Output()
    ], NgxSelectComponent.prototype, "remove", void 0);
    __decorate([
        Output()
    ], NgxSelectComponent.prototype, "navigated", void 0);
    __decorate([
        Output()
    ], NgxSelectComponent.prototype, "selectionChanges", void 0);
    __decorate([
        ViewChild('main', { static: true })
    ], NgxSelectComponent.prototype, "mainElRef", void 0);
    __decorate([
        ViewChild('input')
    ], NgxSelectComponent.prototype, "inputElRef", void 0);
    __decorate([
        ViewChild('choiceMenu')
    ], NgxSelectComponent.prototype, "choiceMenuElRef", void 0);
    __decorate([
        ContentChild(NgxSelectOptionDirective, { read: TemplateRef, static: true })
    ], NgxSelectComponent.prototype, "templateOption", void 0);
    __decorate([
        ContentChild(NgxSelectOptionSelectedDirective, { read: TemplateRef, static: true })
    ], NgxSelectComponent.prototype, "templateSelectedOption", void 0);
    __decorate([
        ContentChild(NgxSelectOptionNotFoundDirective, { read: TemplateRef, static: true })
    ], NgxSelectComponent.prototype, "templateOptionNotFound", void 0);
    __decorate([
        HostListener('document:focusin', ['$event']),
        HostListener('document:click', ['$event'])
    ], NgxSelectComponent.prototype, "documentClick", null);
    NgxSelectComponent = NgxSelectComponent_1 = __decorate([
        Component({
            selector: 'ngx-select',
            template: "<div #main [tabindex]=\"disabled? -1: 0\" class=\"ngx-select dropdown\"\n     [ngClass]=\"setFormControlSize({\n        'ngx-select_multiple form-control': multiple === true,\n        'open show': optionsOpened && optionsFiltered.length\n     }, multiple === true)\"\n     (click)=\"mainClicked($event)\" (focusin)=\"mainClicked($event)\"\n     (focus)=\"focusToInput()\" (keydown)=\"inputKeyDown($event)\">\n    <div [ngClass]=\"{ 'ngx-select__disabled': disabled}\"></div>\n\n    <!-- single selected item -->\n    <div class=\"ngx-select__selected\"\n         *ngIf=\"(multiple === false) && (!optionsOpened || noAutoComplete)\">\n        <div class=\"ngx-select__toggle btn form-control\" [ngClass]=\"setFormControlSize(setBtnSize())\"\n             (click)=\"optionsOpen()\">\n\n            <span *ngIf=\"!optionsSelected.length\" class=\"ngx-select__placeholder text-muted\">\n                <span [innerHtml]=\"placeholder\"></span>\n            </span>\n            <span *ngIf=\"optionsSelected.length\"\n                  class=\"ngx-select__selected-single pull-left float-left\"\n                  [ngClass]=\"{'ngx-select__allow-clear': allowClear}\">\n                <ng-container [ngTemplateOutlet]=\"templateSelectedOption || defaultTemplateOption\"\n                              [ngTemplateOutletContext]=\"{$implicit: optionsSelected[0], index: 0,\n                                                          text: sanitize(optionsSelected[0].text)}\">\n                </ng-container>\n            </span>\n            <span class=\"ngx-select__toggle-buttons\">\n                <a class=\"ngx-select__clear btn btn-sm btn-link\" *ngIf=\"canClearNotMultiple()\"\n                   [ngClass]=\"setBtnSize()\"\n                   (click)=\"optionRemove(optionsSelected[0], $event)\">\n                    <i class=\"ngx-select__clear-icon\"></i>\n                </a>\n                <i class=\"dropdown-toggle\"></i>\n                <i class=\"ngx-select__toggle-caret caret\"></i>\n            </span>\n        </div>\n    </div>\n\n    <!-- multiple selected items -->\n    <div class=\"ngx-select__selected\" *ngIf=\"multiple === true\" (click)=\"inputClick(inputElRef && inputElRef['value'])\">\n        <span *ngFor=\"let option of optionsSelected; trackBy: trackByOption; let idx = index\">\n            <span tabindex=\"-1\" [ngClass]=\"setBtnSize()\" (click)=\"$event.stopPropagation()\"\n                  class=\"ngx-select__selected-plural btn btn-default btn-secondary btn-sm btn-xs\">\n\n                <ng-container [ngTemplateOutlet]=\"templateSelectedOption || defaultTemplateOption\"\n                              [ngTemplateOutletContext]=\"{$implicit: option, index: idx, text: sanitize(option.text)}\">\n                </ng-container>\n\n                <a class=\"ngx-select__clear btn btn-sm btn-link pull-right float-right\" [ngClass]=\"setBtnSize()\"\n                   (click)=\"optionRemove(option, $event)\">\n                    <i class=\"ngx-select__clear-icon\"></i>\n                </a>\n            </span>\n        </span>\n    </div>\n\n    <!-- live search an item from the list -->\n    <input #input type=\"text\" class=\"ngx-select__search form-control\" [ngClass]=\"setFormControlSize()\"\n           *ngIf=\"checkInputVisibility()\"\n           [tabindex]=\"multiple === false? -1: 0\"\n           (keyup)=\"inputKeyUp(input.value, $event)\"\n           [disabled]=\"disabled\"\n           [placeholder]=\"optionsSelected.length? '': placeholder\"\n           (click)=\"inputClick(input.value)\"\n           [autocomplete]=\"autocomplete\"\n           autocorrect=\"off\"\n           autocapitalize=\"off\"\n           spellcheck=\"false\"\n           role=\"combobox\">\n\n    <!-- options template -->\n    <ul #choiceMenu role=\"menu\" *ngIf=\"isFocused\" class=\"ngx-select__choices dropdown-menu\"\n        [ngClass]=\"dropDownMenuOtherClasses\"\n        [class.show]=\"showChoiceMenu()\">\n        <li class=\"ngx-select__item-group\" role=\"menuitem\"\n            *ngFor=\"let opt of optionsFiltered; trackBy: trackByOption; let idxGroup=index\">\n            <div class=\"divider dropdown-divider\" *ngIf=\"opt.type === 'optgroup' && (idxGroup > 0)\"></div>\n            <div class=\"dropdown-header\" *ngIf=\"opt.type === 'optgroup'\">{{opt.label}}</div>\n\n            <a href=\"#\" #choiceItem class=\"ngx-select__item dropdown-item\"\n               *ngFor=\"let option of (opt.optionsFiltered || [opt]); trackBy: trackByOption; let idxOption = index\"\n               [ngClass]=\"{\n                    'ngx-select__item_active active': option.active,\n                    'ngx-select__item_disabled disabled': option.disabled\n               }\"\n               (mouseenter)=\"onMouseEnter({\n                    activeOption: option,\n                    filteredOptionList: optionsFiltered,\n                    index: optionsFiltered.indexOf(option)\n               })\"\n               (click)=\"optionSelect(option, $event)\">\n                <ng-container [ngTemplateOutlet]=\"templateOption || defaultTemplateOption\"\n                              [ngTemplateOutletContext]=\"{$implicit: option, text: option.highlightedText,\n                              index: idxGroup, subIndex: idxOption}\"></ng-container>\n            </a>\n        </li>\n        <li class=\"ngx-select__item ngx-select__item_no-found dropdown-header\" *ngIf=\"!optionsFiltered.length\">\n            <ng-container [ngTemplateOutlet]=\"templateOptionNotFound || defaultTemplateOptionNotFound\"\n                          [ngTemplateOutletContext]=\"{$implicit: inputText}\"></ng-container>\n        </li>\n    </ul>\n\n    <!--Default templates-->\n    <ng-template #defaultTemplateOption let-text=\"text\">\n        <span [innerHtml]=\"text\"></span>\n    </ng-template>\n\n    <ng-template #defaultTemplateOptionNotFound>\n        {{noResultsFound}}\n    </ng-template>\n\n</div>\n",
            changeDetection: ChangeDetectionStrategy.OnPush,
            providers: [
                {
                    provide: NG_VALUE_ACCESSOR,
                    useExisting: forwardRef(function () { return NgxSelectComponent_1; }),
                    multi: true
                }
            ],
            styles: [".ngx-select_multiple{height:auto;padding:3px 3px 0}.ngx-select_multiple .ngx-select__search{background-color:transparent!important;border:none;outline:0;box-shadow:none;height:1.6666em;padding:0;margin-bottom:3px}.ngx-select__disabled{background-color:#eceeef;border-radius:4px;position:absolute;width:100%;height:100%;z-index:5;opacity:.6;top:0;left:0;cursor:not-allowed}.ngx-select__toggle{outline:0;position:relative;text-align:left!important;color:#333;background-color:#fff;border-color:#ccc;display:inline-flex;align-items:stretch;justify-content:space-between}.ngx-select__toggle:hover{color:#333;background-color:#e6e6e6;border-color:#adadad}.ngx-select__toggle-buttons{flex-shrink:0;display:flex;align-items:center}.ngx-select__toggle-caret{position:absolute;height:10px;top:50%;right:10px;margin-top:-2px}.ngx-select__placeholder{float:left;max-width:100%;text-overflow:ellipsis;overflow:hidden}.ngx-select__clear{margin-right:10px;padding:0;border:none}.ngx-select_multiple .ngx-select__clear{line-height:initial;margin-left:5px;margin-right:0;color:#000;opacity:.5}.ngx-select__clear-icon{display:inline-block;font-size:inherit;cursor:pointer;position:relative;width:1em;height:.75em;padding:0}.ngx-select__clear-icon:after,.ngx-select__clear-icon:before{content:\"\";position:absolute;border-top:3px solid;width:100%;top:50%;left:0;margin-top:-1px}.ngx-select__clear-icon:before{transform:rotate(45deg)}.ngx-select__clear-icon:after{transform:rotate(-45deg)}.ngx-select__choices{width:100%;height:auto;max-height:200px;overflow-x:hidden;margin-top:0;position:absolute}.ngx-select_multiple .ngx-select__choices{margin-top:1px}.ngx-select__item{display:block;padding:3px 20px;clear:both;font-weight:400;line-height:1.42857143;white-space:nowrap;cursor:pointer;text-decoration:none}.ngx-select__item_disabled,.ngx-select__item_no-found{cursor:default}.ngx-select__item_active{color:#fff;outline:0;background-color:#428bca}.ngx-select__selected-plural,.ngx-select__selected-single{display:inline-flex;align-items:center;overflow:hidden}.ngx-select__selected-plural span,.ngx-select__selected-single span{overflow:hidden;text-overflow:ellipsis}.ngx-select__selected-plural{outline:0;margin:0 3px 3px 0}.input-group>.dropdown{position:static}"]
        }),
        __param(3, Inject(NGX_SELECT_OPTIONS)), __param(3, Optional())
    ], NgxSelectComponent);
    return NgxSelectComponent;
}());
export { NgxSelectComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXNlbGVjdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtc2VsZWN0LWV4LyIsInNvdXJjZXMiOlsibmd4LXNlbGVjdC9uZ3gtc2VsZWN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNILG1CQUFtQixFQUNuQixPQUFPLEVBQ1AsS0FBSyxFQUNMLE1BQU0sRUFDTixTQUFTLEVBQ1QsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osVUFBVSxFQUNWLFlBQVksRUFDWixjQUFjLEVBQ2QsZUFBZSxFQUNmLGlCQUFpQixFQUNqQixZQUFZLEVBQ1osV0FBVyxFQUNYLFFBQVEsRUFDUixNQUFNLEVBQ04sY0FBYyxFQUNkLHVCQUF1QixFQUN2QixTQUFTLEVBQ1osTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUF1QixpQkFBaUIsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ3ZFLE9BQU8sRUFBQyxZQUFZLEVBQUUsUUFBUSxFQUFDLE1BQU0sMkJBQTJCLENBQUM7QUFDakUsT0FBTyxFQUFhLE9BQU8sRUFBRSxlQUFlLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLGFBQWEsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUNqRyxPQUFPLEVBQUMsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUMvRixPQUFPLEtBQUssUUFBUSxNQUFNLFFBQVEsQ0FBQztBQUNuQyxPQUFPLEtBQUssY0FBYyxNQUFNLHNCQUFzQixDQUFDO0FBQ3ZELE9BQU8sRUFBQyxpQkFBaUIsRUFBRSxlQUFlLEVBQWdCLE1BQU0sc0JBQXNCLENBQUM7QUFDdkYsT0FBTyxFQUNILHdCQUF3QixFQUN4QixnQ0FBZ0MsRUFDaEMsZ0NBQWdDLEVBQ25DLE1BQU0sMkJBQTJCLENBQUM7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QyxnQ0FBZ0MsRUFBRSxFQUFDLElBQUksRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBQyxDQUFDO3NFQUN6QjtJQUd6RDtRQURDLFlBQVksQ0FBQyxnQ0FBZ0MsRUFBRSxFQUFDLElBQUksRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBQyxDQUFDO3NFQUN6QjtJQTJLekQ7UUFGQyxZQUFZLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM1QyxZQUFZLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQzsyREFZMUM7SUEzT1Esa0JBQWtCO1FBYjlCLFNBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxZQUFZO1lBQ3RCLDIwTEFBMEM7WUFFMUMsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07WUFDL0MsU0FBUyxFQUFFO2dCQUNQO29CQUNJLE9BQU8sRUFBRSxpQkFBaUI7b0JBQzFCLFdBQVcsRUFBRSxVQUFVLENBQUMsY0FBTSxPQUFBLG9CQUFrQixFQUFsQixDQUFrQixDQUFDO29CQUNqRCxLQUFLLEVBQUUsSUFBSTtpQkFDZDthQUNKOztTQUNKLENBQUM7UUFzRmUsV0FBQSxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQSxFQUFFLFdBQUEsUUFBUSxFQUFFLENBQUE7T0FyRjFDLGtCQUFrQixDQXVsQjlCO0lBQUQseUJBQUM7Q0FBQSxBQXZsQkQsSUF1bEJDO1NBdmxCWSxrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIEFmdGVyQ29udGVudENoZWNrZWQsXG4gICAgRG9DaGVjayxcbiAgICBJbnB1dCxcbiAgICBPdXRwdXQsXG4gICAgVmlld0NoaWxkLFxuICAgIENvbXBvbmVudCxcbiAgICBFbGVtZW50UmVmLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBmb3J3YXJkUmVmLFxuICAgIEhvc3RMaXN0ZW5lcixcbiAgICBJdGVyYWJsZURpZmZlcixcbiAgICBJdGVyYWJsZURpZmZlcnMsXG4gICAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgQ29udGVudENoaWxkLFxuICAgIFRlbXBsYXRlUmVmLFxuICAgIE9wdGlvbmFsLFxuICAgIEluamVjdCxcbiAgICBJbmplY3Rpb25Ub2tlbixcbiAgICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgICBPbkRlc3Ryb3lcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0NvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUn0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHtEb21TYW5pdGl6ZXIsIFNhZmVIdG1sfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbmltcG9ydCB7T2JzZXJ2YWJsZSwgU3ViamVjdCwgQmVoYXZpb3JTdWJqZWN0LCBFTVBUWSwgb2YsIGZyb20sIG1lcmdlLCBjb21iaW5lTGF0ZXN0fSBmcm9tICdyeGpzJztcbmltcG9ydCB7dGFwLCBmaWx0ZXIsIG1hcCwgc2hhcmUsIGZsYXRNYXAsIHRvQXJyYXksIGRpc3RpbmN0VW50aWxDaGFuZ2VkfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgKiBhcyBsb2Rhc2hOcyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0ICogYXMgZXNjYXBlU3RyaW5nTnMgZnJvbSAnZXNjYXBlLXN0cmluZy1yZWdleHAnO1xuaW1wb3J0IHtOZ3hTZWxlY3RPcHRHcm91cCwgTmd4U2VsZWN0T3B0aW9uLCBUU2VsZWN0T3B0aW9ufSBmcm9tICcuL25neC1zZWxlY3QuY2xhc3Nlcyc7XG5pbXBvcnQge1xuICAgIE5neFNlbGVjdE9wdGlvbkRpcmVjdGl2ZSxcbiAgICBOZ3hTZWxlY3RPcHRpb25Ob3RGb3VuZERpcmVjdGl2ZSxcbiAgICBOZ3hTZWxlY3RPcHRpb25TZWxlY3RlZERpcmVjdGl2ZVxufSBmcm9tICcuL25neC10ZW1wbGF0ZXMuZGlyZWN0aXZlJztcbmltcG9ydCB7SU5neE9wdGlvbk5hdmlnYXRlZCwgSU5neFNlbGVjdE9wdGlvbiwgSU5neFNlbGVjdE9wdGlvbnN9IGZyb20gJy4vbmd4LXNlbGVjdC5pbnRlcmZhY2VzJztcblxuY29uc3QgXyA9IGxvZGFzaE5zO1xuY29uc3QgZXNjYXBlU3RyaW5nID0gZXNjYXBlU3RyaW5nTnM7XG5cbmV4cG9ydCBjb25zdCBOR1hfU0VMRUNUX09QVElPTlMgPSBuZXcgSW5qZWN0aW9uVG9rZW48YW55PignTkdYX1NFTEVDVF9PUFRJT05TJyk7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSU5neFNlbGVjdENvbXBvbmVudE1vdXNlRXZlbnQgZXh0ZW5kcyBNb3VzZUV2ZW50IHtcbiAgICBjbGlja2VkU2VsZWN0Q29tcG9uZW50PzogTmd4U2VsZWN0Q29tcG9uZW50O1xufVxuXG5lbnVtIEVOYXZpZ2F0aW9uIHtcbiAgICBmaXJzdCwgcHJldmlvdXMsIG5leHQsIGxhc3QsXG4gICAgZmlyc3RTZWxlY3RlZCwgZmlyc3RJZk9wdGlvbkFjdGl2ZUludmlzaWJsZVxufVxuXG5mdW5jdGlvbiBwcm9wZXJ0eUV4aXN0cyhvYmo6IG9iamVjdCwgcHJvcGVydHlOYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gcHJvcGVydHlOYW1lIGluIG9iajtcbn1cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICduZ3gtc2VsZWN0JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vbmd4LXNlbGVjdC5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vbmd4LXNlbGVjdC5jb21wb25lbnQuc2NzcyddLFxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgICAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IE5neFNlbGVjdENvbXBvbmVudCksXG4gICAgICAgICAgICBtdWx0aTogdHJ1ZVxuICAgICAgICB9XG4gICAgXVxufSlcbmV4cG9ydCBjbGFzcyBOZ3hTZWxlY3RDb21wb25lbnQgaW1wbGVtZW50cyBJTmd4U2VsZWN0T3B0aW9ucywgQ29udHJvbFZhbHVlQWNjZXNzb3IsIERvQ2hlY2ssIEFmdGVyQ29udGVudENoZWNrZWQsIE9uRGVzdHJveSB7XG4gICAgQElucHV0KCkgcHVibGljIGl0ZW1zOiBhbnlbXTtcbiAgICBASW5wdXQoKSBwdWJsaWMgb3B0aW9uVmFsdWVGaWVsZCA9ICdpZCc7XG4gICAgQElucHV0KCkgcHVibGljIG9wdGlvblRleHRGaWVsZCA9ICd0ZXh0JztcbiAgICBASW5wdXQoKSBwdWJsaWMgb3B0R3JvdXBMYWJlbEZpZWxkID0gJ2xhYmVsJztcbiAgICBASW5wdXQoKSBwdWJsaWMgb3B0R3JvdXBPcHRpb25zRmllbGQgPSAnb3B0aW9ucyc7XG4gICAgQElucHV0KCkgcHVibGljIG11bHRpcGxlID0gZmFsc2U7XG4gICAgQElucHV0KCkgcHVibGljIGFsbG93Q2xlYXIgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBwdWJsaWMgcGxhY2Vob2xkZXIgPSAnJztcbiAgICBASW5wdXQoKSBwdWJsaWMgbm9BdXRvQ29tcGxldGUgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBwdWJsaWMgZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBwdWJsaWMgZGVmYXVsdFZhbHVlOiBhbnlbXSA9IFtdO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBhdXRvU2VsZWN0U2luZ2xlT3B0aW9uID0gZmFsc2U7XG4gICAgQElucHV0KCkgcHVibGljIGF1dG9DbGVhclNlYXJjaCA9IGZhbHNlO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBub1Jlc3VsdHNGb3VuZCA9ICdObyByZXN1bHRzIGZvdW5kJztcbiAgICBASW5wdXQoKSBwdWJsaWMga2VlcFNlbGVjdGVkSXRlbXM6IGZhbHNlO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBzaXplOiAnc21hbGwnIHwgJ2RlZmF1bHQnIHwgJ2xhcmdlJyA9ICdkZWZhdWx0JztcbiAgICBASW5wdXQoKSBwdWJsaWMgc2VhcmNoQ2FsbGJhY2s6IChzZWFyY2g6IHN0cmluZywgaXRlbTogSU5neFNlbGVjdE9wdGlvbikgPT4gYm9vbGVhbjtcbiAgICBASW5wdXQoKSBwdWJsaWMgYXV0b0FjdGl2ZU9uTW91c2VFbnRlciA9IHRydWU7XG4gICAgQElucHV0KCkgcHVibGljIHNob3dPcHRpb25Ob3RGb3VuZEZvckVtcHR5SXRlbXMgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBwdWJsaWMgaXNGb2N1c2VkID0gZmFsc2U7XG4gICAgQElucHV0KCkgcHVibGljIGtlZXBTZWxlY3RNZW51T3BlbmVkID0gZmFsc2U7XG4gICAgQElucHV0KCkgcHVibGljIGF1dG9jb21wbGV0ZSA9ICdvZmYnO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBkcm9wRG93bk1lbnVPdGhlckNsYXNzZXMgPSAnJztcbiAgICBwdWJsaWMga2V5Q29kZVRvUmVtb3ZlU2VsZWN0ZWQgPSAnRGVsZXRlJztcbiAgICBwdWJsaWMga2V5Q29kZVRvT3B0aW9uc09wZW4gPSBbJ0VudGVyJywgJ051bXBhZEVudGVyJ107XG4gICAgcHVibGljIGtleUNvZGVUb09wdGlvbnNDbG9zZSA9ICdFc2NhcGUnO1xuICAgIHB1YmxpYyBrZXlDb2RlVG9PcHRpb25zU2VsZWN0ID0gWydFbnRlcicsICdOdW1wYWRFbnRlciddO1xuICAgIHB1YmxpYyBrZXlDb2RlVG9OYXZpZ2F0ZUZpcnN0ID0gJ0Fycm93TGVmdCc7XG4gICAgcHVibGljIGtleUNvZGVUb05hdmlnYXRlUHJldmlvdXMgPSAnQXJyb3dVcCc7XG4gICAgcHVibGljIGtleUNvZGVUb05hdmlnYXRlTmV4dCA9ICdBcnJvd0Rvd24nO1xuICAgIHB1YmxpYyBrZXlDb2RlVG9OYXZpZ2F0ZUxhc3QgPSAnQXJyb3dSaWdodCc7XG5cbiAgICBAT3V0cHV0KCkgcHVibGljIHR5cGVkID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG4gICAgQE91dHB1dCgpIHB1YmxpYyBmb2N1cyA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcbiAgICBAT3V0cHV0KCkgcHVibGljIGJsdXIgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG4gICAgQE91dHB1dCgpIHB1YmxpYyBvcGVuID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICAgIEBPdXRwdXQoKSBwdWJsaWMgY2xvc2UgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG4gICAgQE91dHB1dCgpIHB1YmxpYyBzZWxlY3QgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgICBAT3V0cHV0KCkgcHVibGljIHJlbW92ZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAgIEBPdXRwdXQoKSBwdWJsaWMgbmF2aWdhdGVkID0gbmV3IEV2ZW50RW1pdHRlcjxJTmd4T3B0aW9uTmF2aWdhdGVkPigpO1xuICAgIEBPdXRwdXQoKSBwdWJsaWMgc2VsZWN0aW9uQ2hhbmdlcyA9IG5ldyBFdmVudEVtaXR0ZXI8SU5neFNlbGVjdE9wdGlvbltdPigpO1xuXG4gICAgQFZpZXdDaGlsZCgnbWFpbicsIHtzdGF0aWM6IHRydWV9KSBwcm90ZWN0ZWQgbWFpbkVsUmVmOiBFbGVtZW50UmVmO1xuICAgIEBWaWV3Q2hpbGQoJ2lucHV0JykgcHVibGljIGlucHV0RWxSZWY6IEVsZW1lbnRSZWY7XG4gICAgQFZpZXdDaGlsZCgnY2hvaWNlTWVudScpIHByb3RlY3RlZCBjaG9pY2VNZW51RWxSZWY6IEVsZW1lbnRSZWY7XG5cbiAgICBAQ29udGVudENoaWxkKE5neFNlbGVjdE9wdGlvbkRpcmVjdGl2ZSwge3JlYWQ6IFRlbXBsYXRlUmVmLCBzdGF0aWM6IHRydWV9KSB0ZW1wbGF0ZU9wdGlvbjogTmd4U2VsZWN0T3B0aW9uRGlyZWN0aXZlO1xuXG4gICAgQENvbnRlbnRDaGlsZChOZ3hTZWxlY3RPcHRpb25TZWxlY3RlZERpcmVjdGl2ZSwge3JlYWQ6IFRlbXBsYXRlUmVmLCBzdGF0aWM6IHRydWV9KVxuICAgIHRlbXBsYXRlU2VsZWN0ZWRPcHRpb246IE5neFNlbGVjdE9wdGlvblNlbGVjdGVkRGlyZWN0aXZlO1xuXG4gICAgQENvbnRlbnRDaGlsZChOZ3hTZWxlY3RPcHRpb25Ob3RGb3VuZERpcmVjdGl2ZSwge3JlYWQ6IFRlbXBsYXRlUmVmLCBzdGF0aWM6IHRydWV9KVxuICAgIHRlbXBsYXRlT3B0aW9uTm90Rm91bmQ6IE5neFNlbGVjdE9wdGlvbk5vdEZvdW5kRGlyZWN0aXZlO1xuXG4gICAgcHVibGljIG9wdGlvbnNPcGVuZWQgPSBmYWxzZTtcbiAgICBwdWJsaWMgb3B0aW9uc0ZpbHRlcmVkOiBUU2VsZWN0T3B0aW9uW107XG5cbiAgICBwcml2YXRlIG9wdGlvbkFjdGl2ZTogTmd4U2VsZWN0T3B0aW9uO1xuICAgIHByaXZhdGUgaXRlbXNEaWZmZXI6IEl0ZXJhYmxlRGlmZmVyPGFueT47XG4gICAgcHJpdmF0ZSBkZWZhdWx0VmFsdWVEaWZmZXI6IEl0ZXJhYmxlRGlmZmVyPGFueVtdPjtcbiAgICBwcml2YXRlIGFjdHVhbFZhbHVlOiBhbnlbXSA9IFtdO1xuXG4gICAgcHVibGljIHN1YmpPcHRpb25zID0gbmV3IEJlaGF2aW9yU3ViamVjdDxUU2VsZWN0T3B0aW9uW10+KFtdKTtcbiAgICBwcml2YXRlIHN1YmpTZWFyY2hUZXh0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+KCcnKTtcblxuICAgIHByaXZhdGUgc3Viak9wdGlvbnNTZWxlY3RlZCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Tmd4U2VsZWN0T3B0aW9uW10+KFtdKTtcbiAgICBwcml2YXRlIHN1YmpFeHRlcm5hbFZhbHVlID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnlbXT4oW10pO1xuICAgIHByaXZhdGUgc3ViakRlZmF1bHRWYWx1ZSA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55W10+KFtdKTtcbiAgICBwcml2YXRlIHN1YmpSZWdpc3Rlck9uQ2hhbmdlID0gbmV3IFN1YmplY3QoKTtcblxuICAgIHByaXZhdGUgY2FjaGVPcHRpb25zRmlsdGVyZWRGbGF0OiBOZ3hTZWxlY3RPcHRpb25bXTtcbiAgICBwcml2YXRlIGNhY2hlRWxlbWVudE9mZnNldFRvcDogbnVtYmVyO1xuXG4gICAgcHJpdmF0ZSBfZm9jdXNUb0lucHV0ID0gZmFsc2U7XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHVibGljIGdldCBpbnB1dFRleHQoKSB7XG4gICAgICAgIGlmICh0aGlzLmlucHV0RWxSZWYgJiYgdGhpcy5pbnB1dEVsUmVmLm5hdGl2ZUVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlucHV0RWxSZWYubmF0aXZlRWxlbWVudC52YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IoaXRlcmFibGVEaWZmZXJzOiBJdGVyYWJsZURpZmZlcnMsIHByaXZhdGUgc2FuaXRpemVyOiBEb21TYW5pdGl6ZXIsIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICAgICAgICAgIEBJbmplY3QoTkdYX1NFTEVDVF9PUFRJT05TKSBAT3B0aW9uYWwoKSBkZWZhdWx0T3B0aW9uczogSU5neFNlbGVjdE9wdGlvbnMpIHtcbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCBkZWZhdWx0T3B0aW9ucyk7XG5cbiAgICAgICAgLy8gRElGRkVSU1xuICAgICAgICB0aGlzLml0ZW1zRGlmZmVyID0gaXRlcmFibGVEaWZmZXJzLmZpbmQoW10pLmNyZWF0ZTxhbnk+KG51bGwpO1xuICAgICAgICB0aGlzLmRlZmF1bHRWYWx1ZURpZmZlciA9IGl0ZXJhYmxlRGlmZmVycy5maW5kKFtdKS5jcmVhdGU8YW55PihudWxsKTtcblxuICAgICAgICAvLyBPQlNFUlZFUlNcbiAgICAgICAgdGhpcy50eXBlZC5zdWJzY3JpYmUoKHRleHQ6IHN0cmluZykgPT4gdGhpcy5zdWJqU2VhcmNoVGV4dC5uZXh0KHRleHQpKTtcbiAgICAgICAgdGhpcy5zdWJqT3B0aW9uc1NlbGVjdGVkLnN1YnNjcmliZSgob3B0aW9uczogTmd4U2VsZWN0T3B0aW9uW10pID0+IHRoaXMuc2VsZWN0aW9uQ2hhbmdlcy5lbWl0KG9wdGlvbnMpKTtcbiAgICAgICAgbGV0IGNhY2hlRXh0ZXJuYWxWYWx1ZTogYW55W107XG5cbiAgICAgICAgLy8gR2V0IGFjdHVhbCB2YWx1ZVxuICAgICAgICBjb25zdCBzdWJqQWN0dWFsVmFsdWUgPSBjb21iaW5lTGF0ZXN0KFtcbiAgICAgICAgICAgIG1lcmdlKFxuICAgICAgICAgICAgICAgIHRoaXMuc3ViakV4dGVybmFsVmFsdWUucGlwZShtYXAoXG4gICAgICAgICAgICAgICAgICAgICh2OiBhbnlbXSkgPT4gY2FjaGVFeHRlcm5hbFZhbHVlID0gdiA9PT0gbnVsbCA/IFtdIDogW10uY29uY2F0KHYpXG4gICAgICAgICAgICAgICAgKSksXG4gICAgICAgICAgICAgICAgdGhpcy5zdWJqT3B0aW9uc1NlbGVjdGVkLnBpcGUobWFwKFxuICAgICAgICAgICAgICAgICAgICAob3B0aW9uczogTmd4U2VsZWN0T3B0aW9uW10pID0+IG9wdGlvbnMubWFwKChvOiBOZ3hTZWxlY3RPcHRpb24pID0+IG8udmFsdWUpXG4gICAgICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICB0aGlzLnN1YmpEZWZhdWx0VmFsdWVcbiAgICAgICAgXSkucGlwZShcbiAgICAgICAgICAgIG1hcCgoW2VWYWwsIGRWYWxdOiBbYW55W10sIGFueVtdXSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1ZhbCA9IF8uaXNFcXVhbChlVmFsLCBkVmFsKSA/IFtdIDogZVZhbDtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3VmFsLmxlbmd0aCA/IG5ld1ZhbCA6IGRWYWw7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCh4LCB5KSA9PiBfLmlzRXF1YWwoeCwgeSkpLFxuICAgICAgICAgICAgc2hhcmUoKVxuICAgICAgICApO1xuXG4gICAgICAgIC8vIEV4cG9ydCBhY3R1YWwgdmFsdWVcbiAgICAgICAgY29tYmluZUxhdGVzdChbc3ViakFjdHVhbFZhbHVlLCB0aGlzLnN1YmpSZWdpc3Rlck9uQ2hhbmdlXSlcbiAgICAgICAgICAgIC5waXBlKG1hcCgoW2FjdHVhbFZhbHVlXTogW2FueVtdLCBhbnlbXV0pID0+IGFjdHVhbFZhbHVlKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKGFjdHVhbFZhbHVlOiBhbnlbXSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYWN0dWFsVmFsdWUgPSBhY3R1YWxWYWx1ZTtcbiAgICAgICAgICAgICAgICBpZiAoIV8uaXNFcXVhbChhY3R1YWxWYWx1ZSwgY2FjaGVFeHRlcm5hbFZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICBjYWNoZUV4dGVybmFsVmFsdWUgPSBhY3R1YWxWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubXVsdGlwbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25DaGFuZ2UoYWN0dWFsVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNoYW5nZShhY3R1YWxWYWx1ZS5sZW5ndGggPyBhY3R1YWxWYWx1ZVswXSA6IG51bGwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ29ycmVjdCBzZWxlY3RlZCBvcHRpb25zIHdoZW4gdGhlIG9wdGlvbnMgY2hhbmdlZFxuICAgICAgICBjb21iaW5lTGF0ZXN0KFtcbiAgICAgICAgICAgIHRoaXMuc3Viak9wdGlvbnMucGlwZShcbiAgICAgICAgICAgICAgICBmbGF0TWFwKChvcHRpb25zOiBUU2VsZWN0T3B0aW9uW10pID0+IGZyb20ob3B0aW9ucykucGlwZShcbiAgICAgICAgICAgICAgICAgICAgZmxhdE1hcCgob3B0aW9uOiBUU2VsZWN0T3B0aW9uKSA9PiBvcHRpb24gaW5zdGFuY2VvZiBOZ3hTZWxlY3RPcHRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgID8gb2Yob3B0aW9uKVxuICAgICAgICAgICAgICAgICAgICAgICAgOiAob3B0aW9uIGluc3RhbmNlb2YgTmd4U2VsZWN0T3B0R3JvdXAgPyBmcm9tKG9wdGlvbi5vcHRpb25zKSA6IEVNUFRZKVxuICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICB0b0FycmF5KClcbiAgICAgICAgICAgICAgICApKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHN1YmpBY3R1YWxWYWx1ZVxuICAgICAgICBdKS5waXBlKFxuICAgICAgICAgICAgbWFwKChbb3B0aW9uc0ZsYXQsIGFjdHVhbFZhbHVlXTogW05neFNlbGVjdE9wdGlvbltdLCBhbnlbXV0pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zU2VsZWN0ZWQgPSBbXTtcblxuICAgICAgICAgICAgICAgIGFjdHVhbFZhbHVlLmZvckVhY2goKHZhbHVlOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRPcHRpb24gPSBvcHRpb25zRmxhdC5maW5kKChvcHRpb246IE5neFNlbGVjdE9wdGlvbikgPT4gb3B0aW9uLnZhbHVlID09PSB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZE9wdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1NlbGVjdGVkLnB1c2goc2VsZWN0ZWRPcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5rZWVwU2VsZWN0ZWRJdGVtcykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25WYWx1ZXMgPSBvcHRpb25zU2VsZWN0ZWQubWFwKChvcHRpb246IE5neFNlbGVjdE9wdGlvbikgPT4gb3B0aW9uLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qga2VwdFNlbGVjdGVkT3B0aW9ucyA9IHRoaXMuc3Viak9wdGlvbnNTZWxlY3RlZC52YWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoc2VsT3B0aW9uOiBOZ3hTZWxlY3RPcHRpb24pID0+IG9wdGlvblZhbHVlcy5pbmRleE9mKHNlbE9wdGlvbi52YWx1ZSkgPT09IC0xKTtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1NlbGVjdGVkLnB1c2goLi4ua2VwdFNlbGVjdGVkT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCFfLmlzRXF1YWwob3B0aW9uc1NlbGVjdGVkLCB0aGlzLnN1YmpPcHRpb25zU2VsZWN0ZWQudmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3Viak9wdGlvbnNTZWxlY3RlZC5uZXh0KG9wdGlvbnNTZWxlY3RlZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KVxuICAgICAgICApLnN1YnNjcmliZSgpO1xuXG4gICAgICAgIC8vIEVuc3VyZSB3b3JraW5nIGZpbHRlciBieSBhIHNlYXJjaCB0ZXh0XG4gICAgICAgIGNvbWJpbmVMYXRlc3QoW3RoaXMuc3Viak9wdGlvbnMsIHRoaXMuc3Viak9wdGlvbnNTZWxlY3RlZCwgdGhpcy5zdWJqU2VhcmNoVGV4dF0pLnBpcGUoXG4gICAgICAgICAgICBtYXAoKFtvcHRpb25zLCBzZWxlY3RlZE9wdGlvbnMsIHNlYXJjaF06IFtUU2VsZWN0T3B0aW9uW10sIE5neFNlbGVjdE9wdGlvbltdLCBzdHJpbmddKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zRmlsdGVyZWQgPSB0aGlzLmZpbHRlck9wdGlvbnMoc2VhcmNoLCBvcHRpb25zLCBzZWxlY3RlZE9wdGlvbnMpLm1hcChvcHRpb24gPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9uIGluc3RhbmNlb2YgTmd4U2VsZWN0T3B0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb24uaGlnaGxpZ2h0ZWRUZXh0ID0gdGhpcy5oaWdobGlnaHRPcHRpb24ob3B0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb24gaW5zdGFuY2VvZiBOZ3hTZWxlY3RPcHRHcm91cCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uLm9wdGlvbnMubWFwKHN1Yk9wdGlvbiA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViT3B0aW9uLmhpZ2hsaWdodGVkVGV4dCA9IHRoaXMuaGlnaGxpZ2h0T3B0aW9uKHN1Yk9wdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1Yk9wdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb247XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZU9wdGlvbnNGaWx0ZXJlZEZsYXQgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMubmF2aWdhdGVPcHRpb24oRU5hdmlnYXRpb24uZmlyc3RJZk9wdGlvbkFjdGl2ZUludmlzaWJsZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRPcHRpb25zO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBmbGF0TWFwKChzZWxlY3RlZE9wdGlvbnM6IE5neFNlbGVjdE9wdGlvbltdKSA9PiB0aGlzLm9wdGlvbnNGaWx0ZXJlZEZsYXQoKS5waXBlKGZpbHRlcihcbiAgICAgICAgICAgICAgICAoZmxhdE9wdGlvbnM6IE5neFNlbGVjdE9wdGlvbltdKSA9PiB0aGlzLmF1dG9TZWxlY3RTaW5nbGVPcHRpb24gJiYgZmxhdE9wdGlvbnMubGVuZ3RoID09PSAxICYmICFzZWxlY3RlZE9wdGlvbnMubGVuZ3RoXG4gICAgICAgICAgICApKSlcbiAgICAgICAgKS5zdWJzY3JpYmUoKGZsYXRPcHRpb25zOiBOZ3hTZWxlY3RPcHRpb25bXSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zdWJqT3B0aW9uc1NlbGVjdGVkLm5leHQoZmxhdE9wdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIHNldEZvcm1Db250cm9sU2l6ZShvdGhlckNsYXNzTmFtZXM6IG9iamVjdCA9IHt9LCB1c2VGb3JtQ29udHJvbDogYm9vbGVhbiA9IHRydWUpIHtcbiAgICAgICAgY29uc3QgZm9ybUNvbnRyb2xFeHRyYUNsYXNzZXMgPSB1c2VGb3JtQ29udHJvbCA/IHtcbiAgICAgICAgICAgICdmb3JtLWNvbnRyb2wtc20gaW5wdXQtc20nOiB0aGlzLnNpemUgPT09ICdzbWFsbCcsXG4gICAgICAgICAgICAnZm9ybS1jb250cm9sLWxnIGlucHV0LWxnJzogdGhpcy5zaXplID09PSAnbGFyZ2UnXG4gICAgICAgIH0gOiB7fTtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oZm9ybUNvbnRyb2xFeHRyYUNsYXNzZXMsIG90aGVyQ2xhc3NOYW1lcyk7XG4gICAgfVxuXG4gICAgcHVibGljIHNldEJ0blNpemUoKSB7XG4gICAgICAgIHJldHVybiB7J2J0bi1zbSc6IHRoaXMuc2l6ZSA9PT0gJ3NtYWxsJywgJ2J0bi1sZyc6IHRoaXMuc2l6ZSA9PT0gJ2xhcmdlJ307XG4gICAgfVxuXG4gICAgcHVibGljIGdldCBvcHRpb25zU2VsZWN0ZWQoKTogTmd4U2VsZWN0T3B0aW9uW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5zdWJqT3B0aW9uc1NlbGVjdGVkLnZhbHVlO1xuICAgIH1cblxuICAgIHB1YmxpYyBtYWluQ2xpY2tlZChldmVudDogSU5neFNlbGVjdENvbXBvbmVudE1vdXNlRXZlbnQpIHtcbiAgICAgICAgZXZlbnQuY2xpY2tlZFNlbGVjdENvbXBvbmVudCA9IHRoaXM7XG4gICAgICAgIGlmICghdGhpcy5pc0ZvY3VzZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaXNGb2N1c2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZm9jdXMuZW1pdCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6Zm9jdXNpbicsIFsnJGV2ZW50J10pXG4gICAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6Y2xpY2snLCBbJyRldmVudCddKVxuICAgIHB1YmxpYyBkb2N1bWVudENsaWNrKGV2ZW50OiBJTmd4U2VsZWN0Q29tcG9uZW50TW91c2VFdmVudCkge1xuICAgICAgICBpZiAoZXZlbnQuY2xpY2tlZFNlbGVjdENvbXBvbmVudCAhPT0gdGhpcykge1xuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9uc09wZW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uc0Nsb3NlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7IC8vIGZpeCBlcnJvciBiZWNhdXNlIG9mIGRlbGF5IGJldHdlZW4gZGlmZmVyZW50IGV2ZW50c1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuaXNGb2N1c2VkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0ZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmJsdXIuZW1pdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvcHRpb25zRmlsdGVyZWRGbGF0KCk6IE9ic2VydmFibGU8Tmd4U2VsZWN0T3B0aW9uW10+IHtcbiAgICAgICAgaWYgKHRoaXMuY2FjaGVPcHRpb25zRmlsdGVyZWRGbGF0KSB7XG4gICAgICAgICAgICByZXR1cm4gb2YodGhpcy5jYWNoZU9wdGlvbnNGaWx0ZXJlZEZsYXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5vcHRpb25zRmlsdGVyZWQpLnBpcGUoXG4gICAgICAgICAgICBmbGF0TWFwPFRTZWxlY3RPcHRpb24sIGFueT4oKG9wdGlvbjogVFNlbGVjdE9wdGlvbikgPT5cbiAgICAgICAgICAgICAgICBvcHRpb24gaW5zdGFuY2VvZiBOZ3hTZWxlY3RPcHRpb24gPyBvZihvcHRpb24pIDpcbiAgICAgICAgICAgICAgICAgICAgKG9wdGlvbiBpbnN0YW5jZW9mIE5neFNlbGVjdE9wdEdyb3VwID8gZnJvbShvcHRpb24ub3B0aW9uc0ZpbHRlcmVkKSA6IEVNUFRZKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGZpbHRlcigob3B0aW9uc0ZpbHRlcmVkRmxhdDogTmd4U2VsZWN0T3B0aW9uKSA9PiAhb3B0aW9uc0ZpbHRlcmVkRmxhdC5kaXNhYmxlZCksXG4gICAgICAgICAgICB0b0FycmF5KCksXG4gICAgICAgICAgICB0YXAoKG9wdGlvbnNGaWx0ZXJlZEZsYXQ6IE5neFNlbGVjdE9wdGlvbltdKSA9PiB0aGlzLmNhY2hlT3B0aW9uc0ZpbHRlcmVkRmxhdCA9IG9wdGlvbnNGaWx0ZXJlZEZsYXQpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBuYXZpZ2F0ZU9wdGlvbihuYXZpZ2F0aW9uOiBFTmF2aWdhdGlvbikge1xuICAgICAgICB0aGlzLm9wdGlvbnNGaWx0ZXJlZEZsYXQoKS5waXBlKFxuICAgICAgICAgICAgbWFwPE5neFNlbGVjdE9wdGlvbltdLCBJTmd4T3B0aW9uTmF2aWdhdGVkPigob3B0aW9uczogTmd4U2VsZWN0T3B0aW9uW10pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBuYXZpZ2F0ZWQ6IElOZ3hPcHRpb25OYXZpZ2F0ZWQgPSB7aW5kZXg6IC0xLCBhY3RpdmVPcHRpb246IG51bGwsIGZpbHRlcmVkT3B0aW9uTGlzdDogb3B0aW9uc307XG4gICAgICAgICAgICAgICAgbGV0IG5ld0FjdGl2ZUlkeDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG5hdmlnYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFTmF2aWdhdGlvbi5maXJzdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRlZC5pbmRleCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFTmF2aWdhdGlvbi5wcmV2aW91czpcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2ZUlkeCA9IG9wdGlvbnMuaW5kZXhPZih0aGlzLm9wdGlvbkFjdGl2ZSkgLSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGVkLmluZGV4ID0gbmV3QWN0aXZlSWR4ID49IDAgPyBuZXdBY3RpdmVJZHggOiBvcHRpb25zLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFTmF2aWdhdGlvbi5uZXh0OlxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZlSWR4ID0gb3B0aW9ucy5pbmRleE9mKHRoaXMub3B0aW9uQWN0aXZlKSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0ZWQuaW5kZXggPSBuZXdBY3RpdmVJZHggPCBvcHRpb25zLmxlbmd0aCA/IG5ld0FjdGl2ZUlkeCA6IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFTmF2aWdhdGlvbi5sYXN0OlxuICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGVkLmluZGV4ID0gb3B0aW9ucy5sZW5ndGggLSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgRU5hdmlnYXRpb24uZmlyc3RTZWxlY3RlZDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN1YmpPcHRpb25zU2VsZWN0ZWQudmFsdWUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGVkLmluZGV4ID0gb3B0aW9ucy5pbmRleE9mKHRoaXMuc3Viak9wdGlvbnNTZWxlY3RlZC52YWx1ZVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFTmF2aWdhdGlvbi5maXJzdElmT3B0aW9uQWN0aXZlSW52aXNpYmxlOlxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGlkeE9mT3B0aW9uQWN0aXZlID0gLTE7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25BY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHhPZk9wdGlvbkFjdGl2ZSA9IG9wdGlvbnMuaW5kZXhPZihvcHRpb25zLmZpbmQoeCA9PiB4LnZhbHVlID09PSB0aGlzLm9wdGlvbkFjdGl2ZS52YWx1ZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGVkLmluZGV4ID0gaWR4T2ZPcHRpb25BY3RpdmUgPiAwID8gaWR4T2ZPcHRpb25BY3RpdmUgOiAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5hdmlnYXRlZC5hY3RpdmVPcHRpb24gPSBvcHRpb25zW25hdmlnYXRlZC5pbmRleF07XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRlZDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICkuc3Vic2NyaWJlKChuZXdOYXZpZ2F0ZWQ6IElOZ3hPcHRpb25OYXZpZ2F0ZWQpID0+IHRoaXMub3B0aW9uQWN0aXZhdGUobmV3TmF2aWdhdGVkKSk7XG4gICAgfVxuXG4gICAgcHVibGljIG5nRG9DaGVjaygpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuaXRlbXNEaWZmZXIuZGlmZih0aGlzLml0ZW1zKSkge1xuICAgICAgICAgICAgdGhpcy5zdWJqT3B0aW9ucy5uZXh0KHRoaXMuYnVpbGRPcHRpb25zKHRoaXMuaXRlbXMpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRlZlZhbCA9IHRoaXMuZGVmYXVsdFZhbHVlID8gW10uY29uY2F0KHRoaXMuZGVmYXVsdFZhbHVlKSA6IFtdO1xuICAgICAgICBpZiAodGhpcy5kZWZhdWx0VmFsdWVEaWZmZXIuZGlmZihkZWZWYWwpKSB7XG4gICAgICAgICAgICB0aGlzLnN1YmpEZWZhdWx0VmFsdWUubmV4dChkZWZWYWwpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIG5nQWZ0ZXJDb250ZW50Q2hlY2tlZCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuX2ZvY3VzVG9JbnB1dCAmJiB0aGlzLmNoZWNrSW5wdXRWaXNpYmlsaXR5KCkgJiYgdGhpcy5pbnB1dEVsUmVmICYmXG4gICAgICAgICAgICB0aGlzLmlucHV0RWxSZWYubmF0aXZlRWxlbWVudCAhPT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5fZm9jdXNUb0lucHV0ID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmlucHV0RWxSZWYubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuY2hvaWNlTWVudUVsUmVmKSB7XG4gICAgICAgICAgICBjb25zdCB1bEVsZW1lbnQgPSB0aGlzLmNob2ljZU1lbnVFbFJlZi5uYXRpdmVFbGVtZW50IGFzIEhUTUxVTGlzdEVsZW1lbnQ7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gdWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Eubmd4LXNlbGVjdF9faXRlbV9hY3RpdmUuYWN0aXZlJykgYXMgSFRNTExpbmtFbGVtZW50O1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudCAmJiBlbGVtZW50Lm9mZnNldEhlaWdodCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuc3VyZVZpc2libGVFbGVtZW50KGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2QuZGV0YWNoKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGNhbkNsZWFyTm90TXVsdGlwbGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmFsbG93Q2xlYXIgJiYgISF0aGlzLnN1YmpPcHRpb25zU2VsZWN0ZWQudmFsdWUubGVuZ3RoICYmXG4gICAgICAgICAgICAoIXRoaXMuc3ViakRlZmF1bHRWYWx1ZS52YWx1ZS5sZW5ndGggfHwgdGhpcy5zdWJqRGVmYXVsdFZhbHVlLnZhbHVlWzBdICE9PSB0aGlzLmFjdHVhbFZhbHVlWzBdKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZm9jdXNUb0lucHV0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9mb2N1c1RvSW5wdXQgPSB0cnVlO1xuICAgIH1cblxuICAgIHB1YmxpYyBpbnB1dEtleURvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAgICAgY29uc3Qga2V5c0Zvck9wZW5lZFN0YXRlID0gW10uY29uY2F0KFxuICAgICAgICAgICAgdGhpcy5rZXlDb2RlVG9PcHRpb25zU2VsZWN0LFxuICAgICAgICAgICAgdGhpcy5rZXlDb2RlVG9OYXZpZ2F0ZUZpcnN0LFxuICAgICAgICAgICAgdGhpcy5rZXlDb2RlVG9OYXZpZ2F0ZVByZXZpb3VzLFxuICAgICAgICAgICAgdGhpcy5rZXlDb2RlVG9OYXZpZ2F0ZU5leHQsXG4gICAgICAgICAgICB0aGlzLmtleUNvZGVUb05hdmlnYXRlTGFzdFxuICAgICAgICApO1xuICAgICAgICBjb25zdCBrZXlzRm9yQ2xvc2VkU3RhdGUgPSBbXS5jb25jYXQodGhpcy5rZXlDb2RlVG9PcHRpb25zT3BlbiwgdGhpcy5rZXlDb2RlVG9SZW1vdmVTZWxlY3RlZCk7XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9uc09wZW5lZCAmJiBrZXlzRm9yT3BlbmVkU3RhdGUuaW5kZXhPZihldmVudC5jb2RlKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQuY29kZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgKFtdLmNvbmNhdCh0aGlzLmtleUNvZGVUb09wdGlvbnNTZWxlY3QpLmluZGV4T2YoZXZlbnQuY29kZSkgKyAxKSAmJiBldmVudC5jb2RlOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvblNlbGVjdCh0aGlzLm9wdGlvbkFjdGl2ZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmF2aWdhdGVPcHRpb24oRU5hdmlnYXRpb24ubmV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5rZXlDb2RlVG9OYXZpZ2F0ZUZpcnN0OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRlT3B0aW9uKEVOYXZpZ2F0aW9uLmZpcnN0KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLmtleUNvZGVUb05hdmlnYXRlUHJldmlvdXM6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmF2aWdhdGVPcHRpb24oRU5hdmlnYXRpb24ucHJldmlvdXMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIHRoaXMua2V5Q29kZVRvTmF2aWdhdGVMYXN0OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRlT3B0aW9uKEVOYXZpZ2F0aW9uLmxhc3QpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIHRoaXMua2V5Q29kZVRvTmF2aWdhdGVOZXh0OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRlT3B0aW9uKEVOYXZpZ2F0aW9uLm5leHQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICghdGhpcy5vcHRpb25zT3BlbmVkICYmIGtleXNGb3JDbG9zZWRTdGF0ZS5pbmRleE9mKGV2ZW50LmNvZGUpICE9PSAtMSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgc3dpdGNoIChldmVudC5jb2RlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAoW10uY29uY2F0KHRoaXMua2V5Q29kZVRvT3B0aW9uc09wZW4pLmluZGV4T2YoZXZlbnQuY29kZSkgKyAxKSAmJiBldmVudC5jb2RlOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNPcGVuKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5rZXlDb2RlVG9SZW1vdmVTZWxlY3RlZDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25SZW1vdmUodGhpcy5zdWJqT3B0aW9uc1NlbGVjdGVkLnZhbHVlW3RoaXMuc3Viak9wdGlvbnNTZWxlY3RlZC52YWx1ZS5sZW5ndGggLSAxXSwgZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyB0cmFja0J5T3B0aW9uKGluZGV4OiBudW1iZXIsIG9wdGlvbjogVFNlbGVjdE9wdGlvbikge1xuICAgICAgICByZXR1cm4gb3B0aW9uIGluc3RhbmNlb2YgTmd4U2VsZWN0T3B0aW9uID8gb3B0aW9uLnZhbHVlIDpcbiAgICAgICAgICAgIChvcHRpb24gaW5zdGFuY2VvZiBOZ3hTZWxlY3RPcHRHcm91cCA/IG9wdGlvbi5sYWJlbCA6IG9wdGlvbik7XG4gICAgfVxuXG4gICAgcHVibGljIGNoZWNrSW5wdXRWaXNpYmlsaXR5KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKHRoaXMubXVsdGlwbGUgPT09IHRydWUpIHx8ICh0aGlzLm9wdGlvbnNPcGVuZWQgJiYgIXRoaXMubm9BdXRvQ29tcGxldGUpO1xuICAgIH1cblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgaW5wdXRLZXlVcCh2YWx1ZTogc3RyaW5nID0gJycsIGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudC5jb2RlID09PSB0aGlzLmtleUNvZGVUb09wdGlvbnNDbG9zZSkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zQ2xvc2UoLyp0cnVlKi8pO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9uc09wZW5lZCAmJiAoWydBcnJvd0Rvd24nLCAnQXJyb3dVcCcsICdBcnJvd0xlZnQnLCAnQXJyb3dEb3duJ10uaW5kZXhPZihldmVudC5jb2RlKSA9PT0gLTEpLyppZ25vcmUgYXJyb3dzKi8pIHtcbiAgICAgICAgICAgIHRoaXMudHlwZWQuZW1pdCh2YWx1ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMub3B0aW9uc09wZW5lZCAmJiB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zT3Blbih2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHVibGljIGlucHV0Q2xpY2sodmFsdWU6IHN0cmluZyA9ICcnKSB7XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zT3BlbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnNPcGVuKHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgc2FuaXRpemUoaHRtbDogc3RyaW5nKTogU2FmZUh0bWwge1xuICAgICAgICByZXR1cm4gaHRtbCA/IHRoaXMuc2FuaXRpemVyLmJ5cGFzc1NlY3VyaXR5VHJ1c3RIdG1sKGh0bWwpIDogbnVsbDtcbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHVibGljIGhpZ2hsaWdodE9wdGlvbihvcHRpb246IE5neFNlbGVjdE9wdGlvbik6IFNhZmVIdG1sIHtcbiAgICAgICAgaWYgKHRoaXMuaW5wdXRFbFJlZikge1xuICAgICAgICAgICAgcmV0dXJuIG9wdGlvbi5yZW5kZXJUZXh0KHRoaXMuc2FuaXRpemVyLCB0aGlzLmlucHV0RWxSZWYubmF0aXZlRWxlbWVudC52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9wdGlvbi5yZW5kZXJUZXh0KHRoaXMuc2FuaXRpemVyLCAnJyk7XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHB1YmxpYyBvcHRpb25TZWxlY3Qob3B0aW9uOiBOZ3hTZWxlY3RPcHRpb24sIGV2ZW50OiBFdmVudCA9IG51bGwpOiB2b2lkIHtcbiAgICAgICAgaWYgKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbiAmJiAhb3B0aW9uLmRpc2FibGVkKSB7XG4gICAgICAgICAgICB0aGlzLnN1YmpPcHRpb25zU2VsZWN0ZWQubmV4dCgodGhpcy5tdWx0aXBsZSA/IHRoaXMuc3Viak9wdGlvbnNTZWxlY3RlZC52YWx1ZSA6IFtdKS5jb25jYXQoW29wdGlvbl0pKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0LmVtaXQob3B0aW9uLnZhbHVlKTtcbiAgICAgICAgICAgIGlmICghdGhpcy5rZWVwU2VsZWN0TWVudU9wZW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uc0Nsb3NlKC8qdHJ1ZSovKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMub25Ub3VjaGVkKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHVibGljIG9wdGlvblJlbW92ZShvcHRpb246IE5neFNlbGVjdE9wdGlvbiwgZXZlbnQ6IEV2ZW50KTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5kaXNhYmxlZCAmJiBvcHRpb24pIHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5zdWJqT3B0aW9uc1NlbGVjdGVkLm5leHQoKHRoaXMubXVsdGlwbGUgPyB0aGlzLnN1YmpPcHRpb25zU2VsZWN0ZWQudmFsdWUgOiBbXSkuZmlsdGVyKG8gPT4gbyAhPT0gb3B0aW9uKSk7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZS5lbWl0KG9wdGlvbi52YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHVibGljIG9wdGlvbkFjdGl2YXRlKG5hdmlnYXRlZDogSU5neE9wdGlvbk5hdmlnYXRlZCk6IHZvaWQge1xuICAgICAgICBpZiAoKHRoaXMub3B0aW9uQWN0aXZlICE9PSBuYXZpZ2F0ZWQuYWN0aXZlT3B0aW9uKSAmJlxuICAgICAgICAgICAgKCFuYXZpZ2F0ZWQuYWN0aXZlT3B0aW9uIHx8ICFuYXZpZ2F0ZWQuYWN0aXZlT3B0aW9uLmRpc2FibGVkKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9uQWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25BY3RpdmUuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMub3B0aW9uQWN0aXZlID0gbmF2aWdhdGVkLmFjdGl2ZU9wdGlvbjtcblxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9uQWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25BY3RpdmUuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGVkLmVtaXQobmF2aWdhdGVkKTtcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHB1YmxpYyBvbk1vdXNlRW50ZXIobmF2aWdhdGVkOiBJTmd4T3B0aW9uTmF2aWdhdGVkKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmF1dG9BY3RpdmVPbk1vdXNlRW50ZXIpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9uQWN0aXZhdGUobmF2aWdhdGVkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZmlsdGVyT3B0aW9ucyhzZWFyY2g6IHN0cmluZywgb3B0aW9uczogVFNlbGVjdE9wdGlvbltdLCBzZWxlY3RlZE9wdGlvbnM6IE5neFNlbGVjdE9wdGlvbltdKTogVFNlbGVjdE9wdGlvbltdIHtcbiAgICAgICAgY29uc3QgcmVnRXhwID0gbmV3IFJlZ0V4cChlc2NhcGVTdHJpbmcoc2VhcmNoKSwgJ2knKSxcbiAgICAgICAgICAgIGZpbHRlck9wdGlvbiA9IChvcHRpb246IE5neFNlbGVjdE9wdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaENhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlYXJjaENhbGxiYWNrKHNlYXJjaCwgb3B0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICghc2VhcmNoIHx8IHJlZ0V4cC50ZXN0KG9wdGlvbi50ZXh0KSkgJiYgKCF0aGlzLm11bHRpcGxlIHx8IHNlbGVjdGVkT3B0aW9ucy5pbmRleE9mKG9wdGlvbikgPT09IC0xKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZmlsdGVyKChvcHRpb246IFRTZWxlY3RPcHRpb24pID0+IHtcbiAgICAgICAgICAgIGlmIChvcHRpb24gaW5zdGFuY2VvZiBOZ3hTZWxlY3RPcHRpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsdGVyT3B0aW9uKG9wdGlvbiBhcyBOZ3hTZWxlY3RPcHRpb24pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb24gaW5zdGFuY2VvZiBOZ3hTZWxlY3RPcHRHcm91cCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN1Yk9wID0gb3B0aW9uIGFzIE5neFNlbGVjdE9wdEdyb3VwO1xuICAgICAgICAgICAgICAgIHN1Yk9wLmZpbHRlcigoc3ViT3B0aW9uOiBOZ3hTZWxlY3RPcHRpb24pID0+IGZpbHRlck9wdGlvbihzdWJPcHRpb24pKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3ViT3Aub3B0aW9uc0ZpbHRlcmVkLmxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBlbnN1cmVWaXNpYmxlRWxlbWVudChlbGVtZW50OiBIVE1MRWxlbWVudCkge1xuICAgICAgICBpZiAodGhpcy5jaG9pY2VNZW51RWxSZWYgJiYgdGhpcy5jYWNoZUVsZW1lbnRPZmZzZXRUb3AgIT09IGVsZW1lbnQub2Zmc2V0VG9wKSB7XG4gICAgICAgICAgICB0aGlzLmNhY2hlRWxlbWVudE9mZnNldFRvcCA9IGVsZW1lbnQub2Zmc2V0VG9wO1xuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyOiBIVE1MRWxlbWVudCA9IHRoaXMuY2hvaWNlTWVudUVsUmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgICAgICBpZiAodGhpcy5jYWNoZUVsZW1lbnRPZmZzZXRUb3AgPCBjb250YWluZXIuc2Nyb2xsVG9wKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLnNjcm9sbFRvcCA9IHRoaXMuY2FjaGVFbGVtZW50T2Zmc2V0VG9wO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNhY2hlRWxlbWVudE9mZnNldFRvcCArIGVsZW1lbnQub2Zmc2V0SGVpZ2h0ID4gY29udGFpbmVyLnNjcm9sbFRvcCArIGNvbnRhaW5lci5jbGllbnRIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuc2Nyb2xsVG9wID0gdGhpcy5jYWNoZUVsZW1lbnRPZmZzZXRUb3AgKyBlbGVtZW50Lm9mZnNldEhlaWdodCAtIGNvbnRhaW5lci5jbGllbnRIZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc2hvd0Nob2ljZU1lbnUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnNPcGVuZWQgJiYgKCEhdGhpcy5zdWJqT3B0aW9ucy52YWx1ZS5sZW5ndGggfHwgdGhpcy5zaG93T3B0aW9uTm90Rm91bmRGb3JFbXB0eUl0ZW1zKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgb3B0aW9uc09wZW4oc2VhcmNoOiBzdHJpbmcgPSAnJykge1xuICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9uc09wZW5lZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnN1YmpTZWFyY2hUZXh0Lm5leHQoc2VhcmNoKTtcbiAgICAgICAgICAgIGlmICghdGhpcy5tdWx0aXBsZSAmJiB0aGlzLnN1YmpPcHRpb25zU2VsZWN0ZWQudmFsdWUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZU9wdGlvbihFTmF2aWdhdGlvbi5maXJzdFNlbGVjdGVkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZU9wdGlvbihFTmF2aWdhdGlvbi5maXJzdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmZvY3VzVG9JbnB1dCgpO1xuICAgICAgICAgICAgdGhpcy5vcGVuLmVtaXQoKTtcbiAgICAgICAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgb3B0aW9uc0Nsb3NlKC8qZm9jdXNUb0hvc3Q6IGJvb2xlYW4gPSBmYWxzZSovKSB7XG4gICAgICAgIHRoaXMub3B0aW9uc09wZW5lZCA9IGZhbHNlO1xuICAgICAgICAvLyBpZiAoZm9jdXNUb0hvc3QpIHtcbiAgICAgICAgLy8gICAgIGNvbnN0IHggPSB3aW5kb3cuc2Nyb2xsWCwgeSA9IHdpbmRvdy5zY3JvbGxZO1xuICAgICAgICAvLyAgICAgdGhpcy5tYWluRWxSZWYubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgICAvLyAgICAgd2luZG93LnNjcm9sbFRvKHgsIHkpO1xuICAgICAgICAvLyB9XG4gICAgICAgIHRoaXMuY2xvc2UuZW1pdCgpO1xuXG4gICAgICAgIGlmICh0aGlzLmF1dG9DbGVhclNlYXJjaCAmJiB0aGlzLm11bHRpcGxlICYmIHRoaXMuaW5wdXRFbFJlZikge1xuICAgICAgICAgICAgdGhpcy5pbnB1dEVsUmVmLm5hdGl2ZUVsZW1lbnQudmFsdWUgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBidWlsZE9wdGlvbnMoZGF0YTogYW55W10pOiBBcnJheTxOZ3hTZWxlY3RPcHRpb24gfCBOZ3hTZWxlY3RPcHRHcm91cD4ge1xuICAgICAgICBjb25zdCByZXN1bHQ6IEFycmF5PE5neFNlbGVjdE9wdGlvbiB8IE5neFNlbGVjdE9wdEdyb3VwPiA9IFtdO1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgZGF0YS5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpc09wdEdyb3VwID0gdHlwZW9mIGl0ZW0gPT09ICdvYmplY3QnICYmIGl0ZW0gIT09IG51bGwgJiZcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlFeGlzdHMoaXRlbSwgdGhpcy5vcHRHcm91cExhYmVsRmllbGQpICYmIHByb3BlcnR5RXhpc3RzKGl0ZW0sIHRoaXMub3B0R3JvdXBPcHRpb25zRmllbGQpICYmXG4gICAgICAgICAgICAgICAgICAgIEFycmF5LmlzQXJyYXkoaXRlbVt0aGlzLm9wdEdyb3VwT3B0aW9uc0ZpZWxkXSk7XG4gICAgICAgICAgICAgICAgaWYgKGlzT3B0R3JvdXApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0R3JvdXAgPSBuZXcgTmd4U2VsZWN0T3B0R3JvdXAoaXRlbVt0aGlzLm9wdEdyb3VwTGFiZWxGaWVsZF0pO1xuICAgICAgICAgICAgICAgICAgICBpdGVtW3RoaXMub3B0R3JvdXBPcHRpb25zRmllbGRdLmZvckVhY2goKHN1Yk9wdGlvbjogTmd4U2VsZWN0T3B0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHQgPSB0aGlzLmJ1aWxkT3B0aW9uKHN1Yk9wdGlvbiwgb3B0R3JvdXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdEdyb3VwLm9wdGlvbnMucHVzaChvcHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gob3B0R3JvdXApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbiA9IHRoaXMuYnVpbGRPcHRpb24oaXRlbSwgbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG9wdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIHByaXZhdGUgYnVpbGRPcHRpb24oZGF0YTogYW55LCBwYXJlbnQ6IE5neFNlbGVjdE9wdEdyb3VwKTogTmd4U2VsZWN0T3B0aW9uIHtcbiAgICAgICAgbGV0IHZhbHVlLCB0ZXh0LCBkaXNhYmxlZDtcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgZGF0YSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHZhbHVlID0gdGV4dCA9IGRhdGE7XG4gICAgICAgICAgICBkaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRhID09PSAnb2JqZWN0JyAmJiBkYXRhICE9PSBudWxsICYmXG4gICAgICAgICAgICAocHJvcGVydHlFeGlzdHMoZGF0YSwgdGhpcy5vcHRpb25WYWx1ZUZpZWxkKSB8fCBwcm9wZXJ0eUV4aXN0cyhkYXRhLCB0aGlzLm9wdGlvblRleHRGaWVsZCkpKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IHByb3BlcnR5RXhpc3RzKGRhdGEsIHRoaXMub3B0aW9uVmFsdWVGaWVsZCkgPyBkYXRhW3RoaXMub3B0aW9uVmFsdWVGaWVsZF0gOiBkYXRhW3RoaXMub3B0aW9uVGV4dEZpZWxkXTtcbiAgICAgICAgICAgIHRleHQgPSBwcm9wZXJ0eUV4aXN0cyhkYXRhLCB0aGlzLm9wdGlvblRleHRGaWVsZCkgPyBkYXRhW3RoaXMub3B0aW9uVGV4dEZpZWxkXSA6IGRhdGFbdGhpcy5vcHRpb25WYWx1ZUZpZWxkXTtcbiAgICAgICAgICAgIGRpc2FibGVkID0gcHJvcGVydHlFeGlzdHMoZGF0YSwgJ2Rpc2FibGVkJykgPyBkYXRhWydkaXNhYmxlZCddIDogZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IE5neFNlbGVjdE9wdGlvbih2YWx1ZSwgdGV4dCwgZGlzYWJsZWQsIGRhdGEsIHBhcmVudCk7XG4gICAgfVxuXG4gICAgLy8vLy8vLy8vLy8vIGludGVyZmFjZSBDb250cm9sVmFsdWVBY2Nlc3NvciAvLy8vLy8vLy8vLy9cbiAgICBwdWJsaWMgb25DaGFuZ2UgPSAodjogYW55KSA9PiB2O1xuXG4gICAgcHVibGljIG9uVG91Y2hlZDogKCkgPT4gdm9pZCA9ICgpID0+IG51bGw7XG5cbiAgICBwdWJsaWMgd3JpdGVWYWx1ZShvYmo6IGFueSk6IHZvaWQge1xuICAgICAgICB0aGlzLnN1YmpFeHRlcm5hbFZhbHVlLm5leHQob2JqKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVnaXN0ZXJPbkNoYW5nZShmbjogKF86IGFueSkgPT4ge30pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5vbkNoYW5nZSA9IGZuO1xuICAgICAgICB0aGlzLnN1YmpSZWdpc3Rlck9uQ2hhbmdlLm5leHQoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVnaXN0ZXJPblRvdWNoZWQoZm46ICgpID0+IHt9KTogdm9pZCB7XG4gICAgICAgIHRoaXMub25Ub3VjaGVkID0gZm47XG4gICAgfVxuXG4gICAgcHVibGljIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICB0aGlzLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcbiAgICAgICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG59XG4iXX0=